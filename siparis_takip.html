<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeliÅŸmiÅŸ SipariÅŸ Takip Sistemi</title>
    <style>
        /* Temel CSS stili */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        h1, h2, h3 {
            text-align: center;
            color: #333;
        }
        /* Form Stilleri */
        .siparis-form input, .siparis-form textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .siparis-form button {
            background-color: #5cb85c;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .siparis-form button:hover {
            background-color: #4cae4c;
        }

        /* Tablo Stilleri */
        .siparis-tablosu {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .siparis-tablosu th, .siparis-tablosu td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: middle;
        }
        .siparis-tablosu th {
            background-color: #f2f2f2;
            color: #333;
        }
        .aktif-tablo-baslik th {
             background-color: #e6f7ff;
        }
        .tamamlanan-tablo-baslik th {
             background-color: #e6ffe6;
        }

        /* Tamamlanma Ã‡ubuÄŸu Stilleri */
        .tamamlanma-bar-container {
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
            width: 100%;
            height: 20px;
        }
        .tamamlanma-bar {
            height: 100%;
            text-align: center;
            color: white;
            line-height: 20px;
            transition: width 0.3s ease-in-out;
            font-size: 12px;
            font-weight: bold;
        }
        /* Tamamlanan satÄ±r iÃ§in Ã¶zel stil */
        .tamamlanan-siparis-satiri {
            background-color: #e6ffe6; 
            color: #008000; 
        }
        
        /* Gelen Miktar & Silme Butonu Grubu */
        .islem-grubu {
             display: flex;
             align-items: center;
             gap: 5px;
             justify-content: space-between;
        }
        .gelen-miktar-grup {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .gelen-miktar-grup input {
            width: 50px; /* Daha dar input */
            padding: 5px;
            margin: 0;
        }
        .gelen-miktar-grup button, .sil-btn {
            padding: 5px 8px; /* ButonlarÄ± kÃ¼Ã§Ã¼lt */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .gelen-miktar-grup button {
            background-color: #007bff;
        }
        .gelen-miktar-grup button:hover {
            background-color: #0056b3;
        }
        .sil-btn {
            background-color: #dc3545; /* KÄ±rmÄ±zÄ± Sil butonu */
        }
        .sil-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ“¦ SipariÅŸ Takip Sistemi</h1>

    <div class="siparis-form">
        <h3>Yeni SipariÅŸ Ekle</h3>
        <input type="text" id="stokKodu" placeholder="Stok Kodu" required>
        <input type="text" id="stokAdi" placeholder="Stok AdÄ±" required>
        <input type="number" id="miktar" placeholder="SipariÅŸ MiktarÄ±" required min="1">
        <input type="text" id="musteri" placeholder="SipariÅŸ Verilen KiÅŸi (MÃ¼ÅŸteri)" required>
        <textarea id="aciklama" placeholder="AÃ§Ä±klama (SipariÅŸ DetaylarÄ±)"></textarea>
        <button onclick="siparisEkle()">SipariÅŸi Kaydet</button>
    </div>

    <hr>

    <h2>ðŸ”” Aktif / Bekleyen SipariÅŸler</h2>
    <table class="siparis-tablosu">
        <thead class="aktif-tablo-baslik">
            <tr>
                <th>Tarih</th>
                <th>Stok Kodu</th>
                <th>Stok AdÄ±</th>
                <th>SipariÅŸ MiktarÄ±</th>
                <th>MÃ¼ÅŸteri</th>
                <th>AÃ§Ä±klama</th>
                <th>Tamamlanma Durumu</th>
                <th style="width: 150px;">Ä°ÅŸlemler</th> </tr>
        </thead>
        <tbody id="aktifSiparisListesi">
            </tbody>
    </table>

    <hr style="margin: 40px 0;">

    <h2>âœ… Tamamlanan SipariÅŸler</h2>
    <table class="siparis-tablosu">
        <thead class="tamamlanan-tablo-baslik">
            <tr>
                <th>Tarih</th>
                <th>Stok Kodu</th>
                <th>Stok AdÄ±</th>
                <th>SipariÅŸ MiktarÄ±</th>
                <th>MÃ¼ÅŸteri</th>
                <th>AÃ§Ä±klama</th>
                <th>Tamamlanma Durumu</th>
                <th style="width: 50px;">Sil</th> </tr>
        </thead>
        <tbody id="tamamlananSiparisListesi">
            </tbody>
    </table>
</div>

<script>
    // --- Veri KalÄ±cÄ±lÄ±ÄŸÄ± (LocalStorage) FonksiyonlarÄ± ---

    const STORAGE_KEY = 'siparisTakipSistemiVerileri';
    let siparisler = [];

    function loadData() {
        const storedData = localStorage.getItem(STORAGE_KEY);
        if (storedData) {
            try {
                return JSON.parse(storedData) || [];
            } catch (e) {
                console.error("LocalStorage verisi bozuk:", e);
                return [];
            }
        }
        return [];
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(siparisler));
    }

    // --- YardÄ±mcÄ± Fonksiyonlar ---

    function hesaplaTamamlanmaYuzdesi(siparis) {
        if (siparis.siparisMiktari === 0) return 0;
        const yuzde = (siparis.gelenMiktar / siparis.siparisMiktari) * 100;
        return Math.min(100, Math.round(yuzde));
    }

    function yuzdeyeGoreRenk(yuzde) {
        if (yuzde === 100) {
            return 'hsl(120, 100%, 30%)'; 
        }
        
        // KÄ±rmÄ±zÄ± TonlarÄ±
        const parlaklik = 90 - (yuzde * 0.6); 
        
        return hsl(0, 100%, ${parlaklik}%);
    }

    // --- SatÄ±r Silme Fonksiyonu ---
    function siparisSil(id) {
        if (confirm("Bu sipariÅŸi kalÄ±cÄ± olarak silmek istediÄŸinizden emin misiniz?")) {
            // SipariÅŸler dizisinden ilgili ID'ye sahip elemanÄ± filtrele
            siparisler = siparisler.filter(s => s.id !== id);
            
            // Veriyi kaydet ve tabloyu yeniden Ã§iz
            saveData();
            tabloyuCiz();
        }
    }

    // --- Ana Ä°ÅŸlem FonksiyonlarÄ± ---

    function siparisEkle() {
        // KayÄ±t yapÄ±lamama sorununu Ã§Ã¶zen dÃ¼zeltme: Input deÄŸerleri doÄŸrudan alÄ±ndÄ±.
        const stokKodu = document.getElementById('stokKodu').value.trim();
        const stokAdi = document.getElementById('stokAdi').value.trim();
        const miktar = parseInt(document.getElementById('miktar').value);
        const musteri = document.getElementById('musteri').value.trim();
        const aciklama = document.getElementById('aciklama').value.trim();

        if (!stokKodu || !stokAdi || isNaN(miktar) || miktar <= 0 || !musteri) {
            alert("LÃ¼tfen tÃ¼m zorunlu alanlarÄ± (Stok Kodu, Stok AdÄ±, SipariÅŸ MiktarÄ±, MÃ¼ÅŸteri) doÄŸru giriniz.");
            return;
        }

        const yeniSiparis = {
            id: Date.now(),
            stokKodu: stokKodu,
            stokAdi: stokAdi,
            siparisMiktari: miktar,
            gelenMiktar: 0,
            musteri: musteri,
            aciklama: aciklama,
            olusturmaTarihi: new Date().toLocaleDateString('tr-TR', { year: 'numeric', month: '2-digit', day: '2-digit' })
        };

        siparisler.push(yeniSiparis);
        saveData();
        tabloyuCiz();

        // Form alanlarÄ±nÄ± temizle
        document.getElementById('stokKodu').value = '';
        document.getElementById('stokAdi').value = '';
        document.getElementById('miktar').value = '';
        document.getElementById('musteri').value = '';
        document.getElementById('aciklama').value = '';
    }

    function gelenMiktarGuncelle(id) {
        const inputId = gelenMiktar-${id};
        const inputElement = document.getElementById(inputId);
        const yeniGelenMiktar = parseInt(inputElement.value);

        if (isNaN(yeniGelenMiktar) || yeniGelenMiktar < 0) {
            alert("LÃ¼tfen geÃ§erli bir miktar giriniz.");
            return;
        }

        const siparisIndex = siparisler.findIndex(s => s.id === id);
        if (siparisIndex !== -1) {
             const maxMiktar = siparisler[siparisIndex].siparisMiktari;
             
             const ayarlanmisMiktar = Math.min(yeniGelenMiktar, maxMiktar);
             siparisler[siparisIndex].gelenMiktar = ayarlanmisMiktar;
            
             if (yeniGelenMiktar > maxMiktar) {
                 inputElement.value = maxMiktar;
                 alert(Gelen miktar, sipariÅŸ miktarÄ±nÄ± (${maxMiktar}) geÃ§emez. Miktar ${maxMiktar} olarak ayarlandÄ±.);
             }

            saveData();
            tabloyuCiz();
        }
    }

    // Tabloyu Ã‡izen (Yeniden OluÅŸturan) Fonksiyon
    function tabloyuCiz() {
        const aktifTbody = document.getElementById('aktifSiparisListesi');
        const tamamlananTbody = document.getElementById('tamamlananSiparisListesi');
        
        aktifTbody.innerHTML = ''; 
        tamamlananTbody.innerHTML = ''; 

        const aktifSiparisler = siparisler.filter(s => hesaplaTamamlanmaYuzdesi(s) < 100);
        const tamamlananSiparisler = siparisler.filter(s => hesaplaTamamlanmaYuzdesi(s) === 100);

        function siparisSatiriOlustur(siparis, isCompleted) {
            const yuzde = hesaplaTamamlanmaYuzdesi(siparis);
            const renk = yuzdeyeGoreRenk(yuzde);

            const row = isCompleted 
                ? tamamlananTbody.insertRow() 
                : aktifTbody.insertRow();
            
            if (isCompleted) {
                row.classList.add('tamamlanan-siparis-satiri');
            }

            // Ortak HÃ¼creler
            row.insertCell().textContent = siparis.olusturmaTarihi;
            row.insertCell().textContent = siparis.stokKodu;
            row.insertCell().textContent = siparis.stokAdi;
            row.insertCell().textContent = ${siparis.siparisMiktari} Adet;
            row.insertCell().textContent = siparis.musteri;
            row.insertCell().textContent = siparis.aciklama;

            // Tamamlanma Ã‡ubuÄŸu HÃ¼cresi
            const tamamlanmaCell = row.insertCell();
            tamamlanmaCell.innerHTML = `
                <div class="tamamlanma-bar-container">
                    <div class="tamamlanma-bar" style="width: ${yuzde}%; background-color: ${renk};">
                        ${yuzde}% (${siparis.gelenMiktar}/${siparis.siparisMiktari})
                    </div>
                </div>
            `;
            
            // Ä°ÅŸlemler HÃ¼cresi
            const islemCell = row.insertCell();
            
            if (!isCompleted) {
                // Aktif sipariÅŸler iÃ§in hem gÃ¼ncelleme hem silme
                islemCell.innerHTML = `
                    <div class="islem-grubu">
                        <div class="gelen-miktar-grup">
                            <input type="number" id="gelenMiktar-${siparis.id}" placeholder="Gelen" min="0" value="${siparis.gelenMiktar}">
                            <button onclick="gelenMiktarGuncelle(${siparis.id})">OK</button>
                        </div>
                        <button class="sil-btn" onclick="siparisSil(${siparis.id})">Sil</button>
                    </div>
                `;
            } else {
                // Tamamlanan sipariÅŸler iÃ§in sadece silme (ayrÄ± sÃ¼tunda)
                islemCell.innerHTML = <button class="sil-btn" onclick="siparisSil(${siparis.id})">Sil</button>;
            }
        }

        aktifSiparisler.forEach(siparis => siparisSatiriOlustur(siparis, false));
        tamamlananSiparisler.forEach(siparis => siparisSatiriOlustur(siparis, true));
    }

    // Sayfa yÃ¼klendiÄŸinde veriyi yÃ¼kle ve tabloyu Ã§iz
    document.addEventListener('DOMContentLoaded', () => {
        siparisler = loadData();
        tabloyuCiz();
    });

</script>

</body>
</html>
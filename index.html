<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Site YÃ¶netim PortalÄ±</title>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --bg: #f1f5f9; --success: #22c55e; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 500px; }
        .card { background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2, h3 { color: var(--primary); margin-top: 0; text-align: center; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-size: 15px; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: var(--primary); color: white; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        .debt { color: #dc2626; font-weight: bold; }
        
        /* Yeni Ã–zellikler Ä°Ã§in Stiller */
        .duyuru-item { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .duyuru-baslik { font-weight: bold; color: #92400e; display: block; }
        .form-group { margin-top: 20px; padding-top: 15px; border-top: 2px dashed #e2e8f0; }
        #talepMesaj { font-size: 0.9em; color: var(--success); text-align: center; display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="login-screen" class="card">
        <h2>Site Sakini PortalÄ±</h2>
        <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ±">
        <input type="password" id="password" placeholder="Åifre">
        <button id="loginBtn" class="btn" onclick="sistemeGiris()">GiriÅŸ Yap</button>
    </div>

    <div id="info-panel" style="display: none;">
        <div class="card" style="background: #fffef0;">
            <h3 style="font-size: 1.1em; color: #b45309;">ğŸ“¢ GÃ¼ncel Duyurular</h3>
            <div id="duyuru-listesi"><small>Duyuru yÃ¼kleniyor...</small></div>
        </div>

        <div class="card">
            <h3 id="display-name"></h3>
            <div class="info-row"><span>Daire No</span><span id="val-no"></span></div>
            <div class="info-row"><span>Aidat Borcu</span><span id="val-aidat" class="debt"></span></div>
            <div class="info-row"><span>YakÄ±t Borcu</span><span id="val-yakit" class="debt"></span></div>
            <div class="info-row"><span>DiÄŸer BorÃ§lar</span><span id="val-diger" class="debt"></span></div>
        </div>

        <div class="card">
            <h3>ğŸ› ï¸ ArÄ±za / Talep Bildir</h3>
            <select id="talepKonu">
                <option value="Ariza">ArÄ±za Bildirimi</option>
                <option value="Temizlik">Temizlik Talebi</option>
                <option value="Guvenlik">GÃ¼venlik / Åikayet</option>
                <option value="Diger">DiÄŸer</option>
            </select>
            <textarea id="talepAciklama" rows="3" placeholder="Sorunu kÄ±saca aÃ§Ä±klayÄ±n..."></textarea>
            <button class="btn" style="background: var(--accent);" onclick="talepGonder()">GÃ¶nder</button>
            <p id="talepMesaj">Talebiniz yÃ¶netime iletildi!</p>
        </div>

        <button class="btn" style="background:#64748b; margin-top: 10px;" onclick="location.reload()">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
</div>

<script>
const scriptUrl = "https://script.google.com/macros/s/AKfycbxI9ocolCXT8pqXK85qkuS7KWBf_lHjlcwTBa-FWCokHYQiq7BAupxTkSZq-qrTg5ao/exec";
const borcUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCjNVASPnz9j40KxsZ7nCoIMBuqQLmxLiXmUM-CXTAp0cW03lM0YlJQMf7IJ054QmTvlTXp3iLMYj/pub?output=csv";
// Duyurular iÃ§in ayrÄ± CSV linki (Google Sheets'ten Duyurular sayfasÄ±nÄ± yayÄ±nlayÄ±p buraya ekleyin)
const duyuruUrl = borcUrl + "&gid=SAYFA_ID_BURAYA"; 

let aktifDaire = "";

async function sistemeGiris() {
    const u = document.getElementById('username').value.trim();
    const p = document.getElementById('password').value.trim();

    try {
        const resp = await fetch('./sifreler.json?t=' + Date.now());
        const data = await resp.json();
        const hesap = data.hesaplar.find(h => h.username === u && String(h.password) === p);

        if (hesap) {
            aktifDaire = hesap.daireNo;
            verileriYukle(hesap.daireNo);
            duyurulariYukle();
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('info-panel').style.display = 'block';
        } else {
            alert("HatalÄ± GiriÅŸ!");
        }
    } catch (e) { alert("Sistem hatasÄ±!"); }
}

async function verileriYukle(dNo) {
    const resp = await fetch(borcUrl + "&t=" + Date.now());
    const csv = await resp.text();
    // CSV parÃ§alama ve filtreleme (Ã¶nceki kodlarla aynÄ± mantÄ±k)
    // ... detaylarÄ± buraya yerleÅŸtirilecek
}

async function duyurulariYukle() {
    // Ã–rnek statik veri (Buraya Sheets'ten Ã§ekme kodu eklenecek)
    const liste = document.getElementById('duyuru-listesi');
    liste.innerHTML = `
        <div class="duyuru-item"><span class="duyuru-baslik">AsansÃ¶r BakÄ±mÄ±</span>YarÄ±n 10:00-12:00 arasÄ± hizmet dÄ±ÅŸÄ±dÄ±r.</div>
        <div class="duyuru-item"><span class="duyuru-baslik">Ä°laÃ§lama</span>Cuma gÃ¼nÃ¼ bahÃ§e ilaÃ§lamasÄ± yapÄ±lacaktÄ±r.</div>
    `;
}

async function talepGonder() {
    const konu = document.getElementById('talepKonu').value;
    const mesaj = document.getElementById('talepAciklama').value;
    if(!mesaj) return alert("LÃ¼tfen aÃ§Ä±klama yazÄ±n.");

    await fetch(scriptUrl, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({ islem: "talepKaydet", daireNo: aktifDaire, konu: konu, mesaj: mesaj })
    });

    document.getElementById('talepAciklama').value = "";
    document.getElementById('talepMesaj').style.display = "block";
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Sakini Portalı</title>
    <style>
        :root { --primary: #1e3a8a; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: var(--primary); color: white; }
        .debt-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .debt-value { color: red; font-weight: bold; }
        .announcement { background: #e0f2fe; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="login-screen" class="card">
        <h3>Site Sakini Girişi</h3>
        <p style="font-size: 0.8em; color: gray;">(Veriler Google Tablo'dan çekilir)</p>
        <input type="text" id="username" placeholder="Kullanıcı Adı">
        <input type="password" id="password" placeholder="Şifre">
        <button class="btn" onclick="sadeceGoogleIleGiris()">Giriş Yap</button>
    </div>

    <div id="main-panel" class="card" style="display: none;">
        <h3 id="welcome-msg"></h3>
        <div id="duyuru-alani"></div>
        <div class="debt-row"><span>Aidat:</span><span id="aidat" class="debt-value"></span></div>
        <div class="debt-row"><span>Yakıt:</span><span id="yakit" class="debt-value"></span></div>
        <div class="debt-row"><span>Diğer:</span><span id="diger" class="debt-value"></span></div>
        <button class="btn" style="background:#64748b; margin-top:20px;" onclick="location.reload()">Çıkış</button>
    </div>
</div>

<script>
// Sadece senin Google Sheets linkin
const gSheetLink = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCjNVASPnz9j40KxsZ7nCoIMBuqQLmxLiXmUM-CXTAp0cW03lM0YlJQMf7IJ054QmTvlTXp3iLMYj/pub?output=csv";

async function sadeceGoogleIleGiris() {
    const u = document.getElementById('username').value.trim();
    const p = document.getElementById('password').value.trim();

    try {
        // Eski JSON dosyasını değil, doğrudan Google linkini çağırıyoruz
        const response = await fetch(gSheetLink + "&t=" + new Date().getTime());
        const csvText = await response.text();
        
        // CSV'yi JSON'a çevir
        const satirlar = csvText.split('\n').filter(s => s.trim() !== '');
        const basliklar = satirlar[0].split(',').map(b => b.trim().replace(/^"|"$/g, ''));
        
        const veriler = satirlar.slice(1).map(satir => {
            const degerler = satir.split(',').map(d => d.trim().replace(/^"|"$/g, ''));
            let obje = {};
            basliklar.forEach((baslik, index) => {
                obje[baslik] = degerler[index] || "";
            });
            return obje;
        });

        console.log("Google'dan gelen güncel liste:", veriler);

        // Arama yap
        const kullanıcı = veriler.find(d => String(d.username) === u && String(d.password) === p);

        if (kullanıcı) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-panel').style.display = 'block';
            
            document.getElementById('welcome-msg').innerText = "Sn. " + kullanıcı.sahibi;
            document.getElementById('aidat').innerText = kullanıcı.aidatBorcu + " TL";
            document.getElementById('yakit').innerText = kullanıcı.yakitBorcu + " TL";
            document.getElementById('diger').innerText = kullanıcı.digerBorc + " TL";
            
            // Not varsa duyuru olarak göster
            if(kullanıcı.not) {
                document.getElementById('duyuru-alani').innerHTML = `<div class="announcement"><b>Not:</b> ${kullanıcı.not}</div>`;
            }
        } else {
            alert("Hatalı Giriş! Lütfen Google Tablo'daki güncel kullanıcı adı ve şifreyi kullanın.");
        }
    } catch (hata) {
        alert("Bağlantı Hatası: Veriler Google'dan alınamadı.");
    }
}
</script>

</body>
</html>
